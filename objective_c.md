<a id="home"></a>
# Objective-C
[Course](https://www.lynda.com/Objective-C-tutorials/Objective-C-Essential-Training/143328-2.html "lynda.com")

* [Intro        ](#intro        )
* [Types        ](#types        )
* [Objects      ](#objects      )
* [Memory       ](#memory       )
* [Oop          ](#oop          )
* [Collections  ](#collections  )
* [Files        ](#files        )
* [Serialize    ](#serialize    )
* [Categories   ](#categories   )
* [Extensions   ](#extensions   )
* [Protocols    ](#protocols    )
* [Dynamic types](#dynamic_types)
* [Exceptions   ](#exceptions   )

***

<a id="intro"></a>
## Intro [home](#home)
    void someFunc() {
        MyClass *foo = [[MyClass alloc] init];
        [foo someMet]; 
        [foo someMet:arg];
        NSLog(@"there is %i secs", 15); // placeholders
    }

history:
- 72 - C
- 80 - Smalltalk
- 86 - Obj-C
- 88 - NeXT
- 89 - NeXTStep 1.0 (NS)
- 95 - NeXTStep 3.3
- 96 - Apple
- 01 - Mac OS X
- 07 - iPhone, Mac OS X 10.5, Obj-C 2.0
- 10 - iPad

class modifiers:
- @interface
- @implementation
- @property
- @protocol

classes:
- NSLog
- NSString
- NSDate
- NSAutoReleasePool


***

<a id="types"></a>
## Types [home](#home)

    BOOL flag;
    flag = YES;
    flag = NO;

    enum e {a,b,c};
    enum e value = a;

    NSString *s = @"hello";


***

<a id="objects"></a>
## Objects [home](#home)
all is poiner

Class:
- properties: name, height
- methods: run, jump

example:

    NSFileManager   replaceItemAtUrl:
                    withItemAtUrl:
                    backupItemName:
                    options:
                    resultingItemUrl:
                    error:

    [o foo:[o2 getVal]] // o.foo(o2.getVal())
    res = [o insertString:str atIndex:i]; // res = o.insertString(str, i);

static, obj methods:

    + (NSDate*) date();             // static(class) method
        [NSDate date]
    - (NSString*) uppercaseString() // instance(object) method
        [msg uppercaseString]


***

<a id="memory"></a>
## Memory [home](#home)
ref-cnt, auto-ref-cnt(ARC) (not GC)

    MyClass *foo = [[MyClass alloc] init]; // ctor
    // [foo release];  // dtor - added by compiler (do not allow)
    // [foo retain]; [foo autorelease];


    //NSDate *myDate = [NSDate new]; // not used; alloc, init, assign pointer
    NSDate *myDate = [[NSDate alloc] init]; // uses release
    NSDate *myDate = [NSDate date];         // uses autorelease pool

    Person *pers = [[Person alloc] initWithName:@"John Daw"];


***

<a id="oop"></a>
## OOP [home](#home)
subclass(deri), direct superclass(base)

Emploee.h:

    #import <Foundation/Foundation.h>

    @interface Emploee : NSObject    

    //{
    //    int _oldStyle; // underscoped; need to manualy create seter/geter
    //}

    - (id) initWithInt: (int) initialScore; // returns id - object pointer

    @property (strong) NSString *name; // strong-ref (default)
    @property (weak) NSDate *date; // weak-ref
    @property (readonly) int xz; // only getter
    @property (nonatomic) int id; // threads-related
    @property int score;   // autogenerated setName, getName

    - (void) someMethod;
    - (NSString*) createMessage: (NSString*) input;

    - (int) timesTen: (int) num;
    - (int) addNumber: (int) a   
             toNumber: (int) b;

    @end

Emploee.m:

    @implementation Emploee

    {
        int privateVar; 
    }

    // @synthesize oldStyle;

    // take from "Objective-C init method" template
    //- (id) init {
    //    self = [super init];    /// self == this
    //    if (self) {             /// nil == null
    //        // yuor initialisation code
    //        _score = 5000; // underscoped!!!
    //    }
    //    return self;
    //}
    // use other ctor

    - (id) init {
        self = [self initWithInt: 5000];
        return self;
    }

    - (id) initWithInt: (int) initialScore {
        self = [super init];    /// self == this
        if (self) {             /// nil == null
            // yuor initialisation code
            _score = initialScore; // underscoped!!!
        }
        return self;
    }

    - (void) dealloc {
        // release resources: ex: close connection to db
        NSLog(@"closing connection...");
        // custom deallocations - not needed as ARC used
        //[name release];
        //[super dealloc];
    }

    - (void) someMethod {
        NSLog(@"someMethod");
    }

    - (int) addNumber: (int) a   
             toNumber: (int) b
     {
        return a + b;
     }

    @end

main.m:

    #import "Emploee.h"

    Emploee *e = [[Emploee alloc] init];
    [e setName:@"John"];
    [e someMethod];
    NSLog(@"id %i", [e id]); // getter

    int res = [e addNumber:2 toNumber:2];
    NSLog(@"result %i", res);


***

<a id="collections"></a>
## Collections [home](#home)
c-style:

    int arr[5] = {1,2,3,4,5};

immutable array:

    NSArray* arr = [[NSArray alloc] initWithObjects: @"one", @"two", @"tre", myDate, nil]; // diff types
    NSArray* arr = @[@"one", @"two", @"tre"];
    [arr objectAtIndex:2];
    arr[2]; // newly

mutable array:

    NSMutableArray arr;
    addObject, removeObjectAtIndex
    // no-way: NSMutableArray* arr = @[@"one", @"two", @"tre"];


dictionary immutable:

    NSDictionary* states = [[NSDictionary alloc] 
        initWithObjsAndKeys: @"Object", @"Key"
            , @"Califonrina", @"CA"
            , @"Ariozna", @"AR"
            , nil];
    NSDictionary* states = @{ key:obj, key2:obj2, key3:obj3 };
    [states objectForKey:@"AR"];
    states[@"CA"];

    NSMutableDictionary
    [mutaStates setObject:@"Florida" ForKey:@"FL"];

loop through elements:

    for (type var in collection)
    for (NSString* st in states)


***

<a id="files"></a>
## Files [home](#home)
print filenames in directory

    NSString* sndPath = @"/System/Library/Sounds";
    NSFileManager* fm = [[NSFileManager alloc] init];
    NSArray* sndFiles = [fm subpathsAsPath:sndPath];
    for (NSString* file in sndFiles) {
        NSLog(@"filname %@", file);
    }

NSFileManager methods:
- defaultManager
- fileExists
- attributes
- URLForDir

example:

    NSString* homeDir = NSHomeDirectory();
    NSString* desktopDir = [homeDir stringByAppendingPathComponent:@"Desktop"];

    NSURL* url = [NSURL fileURLWithPath:path];
    NSString* path = [url absoluteString];


    NSURL* docDir = [[NSFileManager defaultManager] URLForDirectory: ...];
    NSURL* full = [docDir URLByAppendingPathComponent:@"sample.txt"];
    NSString* content = [[NSString alloc] initWithContentsOfURL:full ...];
    NSMutableString
    [content saveToURL:saveUrl ...];


***

<a id="serialize"></a>
## Serialize [home](#home)
other solutions: db, CoreData

- NSKeyedArchiver
- NSKeyedUnarchiver

example:

    @interface Emploee: NSObject <NSCoding>
    @property int id;
    @property NSString* data;
    -(NSString*)description();
    @end

    @implementation Emploee
    - (NSString*) description() {
        NSString desc = [NSString stringWithFormat:@"Emp id: %i; data: %@", [self id], [self data]];
        return desc
    }

    - (void) encodeWithCoder: (NSCoder*)coder {
        [coder encodeInt:self.id forKey:@"id"];
        [coder encodeObject:self.data forKey:@"data"];
    }

    - (id) initWithCoder: (NSCoder*)decoder {
        self = [super init];
        if (self) {
            _id = [decoder decodeIntForKey:@"id"];
            _data = [decoder decodeObjectForKey:@"data"];
        }
        return self;
    }
    @end

    Emploee* bob = [[Emploee alloc] init];
    Emploee* alice = [[Emploee alloc] init];
    NSMutableArray* emps = [[NSMutableArray alloc] init];
    [emps addObj:bob];
    [emps addObj:alice];

    NSLog(@"Bob %@", bob); // uses (NSString*)description() for output

    [NSKeyedArchiver archiveRootObject:emps toFile:@"/Users/bacchus/Desktop/emps.plist"];

    NSMutableArray* emps = [NSKeyedUnarchiver unarchiveObjectsWithFile:@"/Users/bacchus/Desktop/emps.plist"];


***

<a id="categories"></a>
## Categories [home](#home)
add only behaviour (methods)

#### inherit add custom methods:
    @interface MyString: String
    - (void) customMethod ();
    @end

#### categories:
    @interface NSString (Fmt)
    - (NSString*)space2dash;
    @end

    @implementation NSString (Fmt)
    -(NSString *)space2dash {
        NSString* newStr = [self stringByReplacingOccurrencesOfString:@" " withString:@"_"];
        return newStr;
    }
    @end

    NSString* msg = @"quick brownd fox......";
    NSLog(@"%@", [msg space2dash]);


***

<a id="extensions"></a>
## Extensions [home](#home)
adds only private-like properties  
to add private method - write it in .m and not in .h

Account_private.h:

    @interface Account ()
    @property NSString* privateKey;
    @property NSString* pubRO;
    @end

Account.h:

    @interface Account : NSObject
    @property (readonly) NSString* pubRO;
    @end

Account.m:

    #import "Account.h"
    #import "Account_private.h" // or just put here all priv code

    @implementation Account
    - (NSString*) description () {
        return _privateKey;
    }
    @end

main.m:

    Account* acc = [[Account alloc] init];
    acc.privateKey = @"hacked";             // error: privateKey is private
    NSLog(@"key is: %@", acc.privateKey);   // error: privateKey is private
    acc.pubRO = @"hacked";                  // error: write to pubRO
    NSLog(@"key is: %@", acc.pubRO);        // ok: pubRO is readonly


***

<a id="protocols"></a>
## Protocols [home](#home)
set of properties and methods
- <NSCoding> // protocol
- initWithCoder
- encodeWithCoder

example:

    @protocol Cleaner <NSObject>
    - (void) clean;
    - (void) washWindows;
    @end

    @interface Emploee: NSObject <Cleaner, NSCoding>
    @end


***

<a id="dynamic_types"></a>
## Dynamic types [home](#home)
id - generic obj pointer

    NSMutableArray* bunchOfObjects = [[NSMutableArray alloc] init];
    [bunchOfObjects addObject: @"stirng"];
    [bunchOfObjects addObject: [[NSDate alloc] init]];

    for (id obj in bunchOfObjects) {
        if ( [obj isKindOfClass: [NSString class]] ) {
            NSLog(@"%@", [obj uppercaseString]);
        }
        // beter
        if ( [obj respondsToSelector:@selector(uppercaseString)] ) {
            NSLog(@"%@", [obj uppercaseString]);
        }
    }


***

<a id="exceptions"></a>
## Exceptions [home](#home)
if exception thrown in objective-c prefer to free resources and gracefully shutdown app

    @try {  
        id today = [[NSDate alloc] init];
        [today uppercaseString]; // throws NSInvalidArgumentException
    } @catch (NSException* e) {
        NSLog(@"except: %@", e);
    } @finaly {
        NSLog(@"calls in any situation");        
    }
